<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astro Tech BLC</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0d1b2a;
      color: white;
      text-align: center;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    input, button {
      padding: 10px 15px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    input {
      width: 200px;
      background-color: #1b263b;
      color: white;
    }
    input:focus {
      outline: 2px solid #4a90e2;
    }
    button {
      background-color: #4a90e2;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover {
      background-color: #357abd;
      transform: translateY(-2px);
    }
    button[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
      background-color: #666;
      transform: none;
    }
    #astro-info {
      margin: 20px auto;
      background-color: #1b263b;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      min-height: 100px;
    }
    #sky-map {
      display: block;
      margin: 20px auto;
      width: 100%;
      height: 400px;
      border-radius: 8px;
      overflow: hidden;
    }
    .loading {
      display: none;
      margin: 20px;
      text-align: center;
    }
    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4a90e2;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .error-message {
      color: #ff6b6b;
      margin: 10px 0;
      padding: 10px;
      background-color: rgba(255, 107, 107, 0.1);
      border-radius: 5px;
      display: none;
      transition: opacity 0.3s ease;
    }
    .error-message.show {
      display: block;
      opacity: 1;
    }
    .success-message {
      color: #4CAF50;
      margin: 10px 0;
      padding: 10px;
      background-color: rgba(76, 175, 80, 0.1);
      border-radius: 5px;
      display: none;
      transition: opacity 0.3s ease;
    }
    .success-message.show {
      display: block;
      opacity: 1;
    }
    .coordinates-input {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    .moon-phase {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    .moon-phase-item {
      background-color: #2c3e50;
      padding: 10px;
      border-radius: 5px;
      min-width: 150px;
    }
    .moon-phase-value {
      font-size: 1.2em;
      font-weight: bold;
      margin: 5px 0;
    }
    .moon-phase-date {
      color: #95a5a6;
      font-size: 0.9em;
    }
    .location-info {
      margin-top: 20px;
      padding: 10px;
      background-color: #2c3e50;
      border-radius: 5px;
    }
    .header-logo {
      width: 50px;
      height: 50px;
      vertical-align: middle;
      margin-right: 10px;
    }
    h1 {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: #4a90e2;
      font-size: 2.5em;
      margin-bottom: 20px;
    }
    .title-emoji {
      font-size: 1.2em;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    @media (max-width: 768px) {
      .coordinates-input {
        flex-direction: column;
        align-items: center;
      }
      input {
        width: 80%;
      }
      #sky-map {
        height: 300px;
      }
      #astro-info {
        width: 95%;
      }
      .moon-phase {
        flex-direction: column;
        align-items: center;
      }
      .moon-phase-item {
        width: 80%;
      }
    }
    .server-warning {
      background-color: #ff9800;
      color: white;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      text-align: center;
      font-weight: bold;
    }
    .server-warning a {
      color: white;
      text-decoration: underline;
      display: block;
      margin-top: 10px;
    }
    .server-warning code {
      background-color: rgba(0,0,0,0.2);
      padding: 2px 5px;
      border-radius: 3px;
      font-family: monospace;
    }
    .info-section {
      background-color: #1b263b;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      width: 80%;
      margin-left: auto;
      margin-right: auto;
    }
    .section-title {
      color: #4a90e2;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .weather-info {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 15px;
    }
    .weather-card {
      background-color: #2c3e50;
      padding: 15px;
      border-radius: 5px;
      min-width: 150px;
      text-align: center;
    }
    .satellite-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .satellite-card {
      background-color: #2c3e50;
      padding: 15px;
      border-radius: 5px;
      text-align: center;
    }
    .galaxy-info {
      text-align: center;
      padding: 15px;
    }
    .galaxy-stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .stat-card {
      background-color: #2c3e50;
      padding: 15px;
      border-radius: 5px;
      min-width: 120px;
    }
    .tab-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .tab-button {
      padding: 10px 20px;
      background-color: #2c3e50;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1.1em;
    }
    .tab-button.active {
      background-color: #4a90e2;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .planet-info {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .planet-card {
      background-color: #2c3e50;
      padding: 15px;
      border-radius: 8px;
      width: 200px;
      text-align: center;
      transition: transform 0.3s;
    }
    .planet-card:hover {
      transform: translateY(-5px);
    }
    .planet-name {
      font-size: 1.2em;
      color: #4a90e2;
      margin-bottom: 10px;
    }
    .planet-details {
      font-size: 0.9em;
      color: #95a5a6;
    }
    .galaxy-scene {
      width: 100%;
      height: 500px;
      margin: 20px 0;
      border-radius: 8px;
      overflow: hidden;
      background: linear-gradient(to bottom, #000000, #1a1a2e);
    }
    #stars-container {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    #stars-1, #stars-2 {
      background-image: radial-gradient(white 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.5;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    #solar-system {
      z-index: 2;
      position: relative;
    }
    @media (max-width: 768px) {
      .info-section {
        width: 95%;
      }
      .weather-info, .satellite-info, .galaxy-stats {
        flex-direction: column;
        align-items: center;
      }
      .galaxy-scene {
        height: 300px;
      }
    }
    a-sky {
      background-image: radial-gradient(white 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .camera-button {
      cursor: pointer;
      transition: all 0.3s;
    }
    .camera-button:hover {
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><span class="title-emoji">üåå</span> Astro Tech BLC</h1>
    
    <p>Informe sua latitude e longitude ou clique em "Usar Localiza√ß√£o Atual":</p>
    <div class="coordinates-input">
      <input type="number" id="lat" placeholder="Latitude" step="any" min="-90" max="90" aria-label="Informe sua latitude" required />
      <input type="number" id="lon" placeholder="Longitude" step="any" min="-180" max="180" aria-label="Informe sua longitude" required />
    </div>
    <div>
      <button onclick="usarLocalizacao()" aria-label="Usar localiza√ß√£o atual" id="location-btn">üìç Usar Localiza√ß√£o Atual</button>
      <button onclick="carregarAstros()" aria-label="Carregar dados astron√¥micos" id="load-btn">üî≠ Ver C√©u</button>
    </div>

    <div class="loading" id="loading">
      <p>Carregando dados astron√¥micos...</p>
    </div>

    <div id="error-message" class="error-message" role="alert"></div>
    <div id="success-message" class="success-message" role="status"></div>

    <div class="tab-buttons">
      <button class="tab-button active" onclick="showTab('moon')">üåô Fases da Lua</button>
      <button class="tab-button" onclick="showTab('weather')">üå§Ô∏è Clima</button>
      <button class="tab-button" onclick="showTab('satellites')">üõ∞Ô∏è Sat√©lites</button>
      <button class="tab-button" onclick="showTab('galaxy')">üåå Gal√°xia</button>
      <button class="tab-button" onclick="showTab('planets')">ü™ê Planetas</button>
    </div>

    <div id="astro-info" class="info-section tab-content active">
      <!-- Conte√∫do das fases da lua ser√° inserido aqui -->
    </div>

    <div id="weather-info" class="info-section tab-content">
      <h2 class="section-title">üå§Ô∏è Condi√ß√µes Clim√°ticas</h2>
      <div class="weather-info">
        <div class="weather-card">
          <div class="weather-icon">‚òÄÔ∏è</div>
          <div class="weather-value" id="temperature">--¬∞C</div>
          <div class="weather-label">Temperatura</div>
        </div>
        <div class="weather-card">
          <div class="weather-icon">üí®</div>
          <div class="weather-value" id="wind">-- km/h</div>
          <div class="weather-label">Vento</div>
        </div>
        <div class="weather-card">
          <div class="weather-icon">üíß</div>
          <div class="weather-value" id="humidity">--%</div>
          <div class="weather-label">Umidade</div>
        </div>
        <div class="weather-card">
          <div class="weather-icon">üåßÔ∏è</div>
          <div class="weather-value" id="precipitation">--%</div>
          <div class="weather-label">Precipita√ß√£o</div>
        </div>
      </div>
    </div>

    <div id="satellites-info" class="info-section tab-content">
      <h2 class="section-title">üõ∞Ô∏è Sat√©lites Vis√≠veis</h2>
      <div class="satellite-info">
        <div class="satellite-card">
          <div class="satellite-name">ISS</div>
          <div class="satellite-status" id="iss-status">N√£o vis√≠vel</div>
          <div class="satellite-next" id="iss-next">Pr√≥xima passagem: --:--</div>
        </div>
        <div class="satellite-card">
          <div class="satellite-name">Hubble</div>
          <div class="satellite-status" id="hubble-status">N√£o vis√≠vel</div>
          <div class="satellite-next" id="hubble-next">Pr√≥xima passagem: --:--</div>
        </div>
      </div>
    </div>

    <div id="galaxy-info" class="info-section tab-content">
      <h2 class="section-title">üåå Movimento da Gal√°xia</h2>
      <div class="galaxy-info">
        <p>Posi√ß√£o atual em rela√ß√£o ao centro da Via L√°ctea</p>
        <div class="galaxy-stats">
          <div class="stat-card">
            <div class="stat-value" id="galaxy-distance">-- anos-luz</div>
            <div class="stat-label">Dist√¢ncia do centro</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="galaxy-speed">-- km/s</div>
            <div class="stat-label">Velocidade orbital</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="galaxy-period">-- milh√µes de anos</div>
            <div class="stat-label">Per√≠odo orbital</div>
          </div>
        </div>
      </div>
    </div>

    <div id="planets-info" class="info-section tab-content">
      <h2 class="section-title">ü™ê Sistema Solar</h2>
      <div class="planet-info">
        <div class="planet-card">
          <div class="planet-name">Merc√∫rio</div>
          <div class="planet-details">
            <p>Dist√¢ncia: 0.39 AU</p>
            <p>Per√≠odo: 88 dias</p>
            <p>Temperatura: -173¬∞C a 427¬∞C</p>
          </div>
        </div>
        <div class="planet-card">
          <div class="planet-name">V√™nus</div>
          <div class="planet-details">
            <p>Dist√¢ncia: 0.72 AU</p>
            <p>Per√≠odo: 225 dias</p>
            <p>Temperatura: 462¬∞C</p>
          </div>
        </div>
        <div class="planet-card">
          <div class="planet-name">Terra</div>
          <div class="planet-details">
            <p>Dist√¢ncia: 1 AU</p>
            <p>Per√≠odo: 365 dias</p>
            <p>Temperatura: -88¬∞C a 58¬∞C</p>
          </div>
        </div>
        <div class="planet-card">
          <div class="planet-name">Marte</div>
          <div class="planet-details">
            <p>Dist√¢ncia: 1.52 AU</p>
            <p>Per√≠odo: 687 dias</p>
            <p>Temperatura: -140¬∞C a 20¬∞C</p>
          </div>
        </div>
        <div class="planet-card">
          <div class="planet-name">J√∫piter</div>
          <div class="planet-details">
            <p>Dist√¢ncia: 5.2 AU</p>
            <p>Per√≠odo: 12 anos</p>
            <p>Temperatura: -110¬∞C</p>
          </div>
        </div>
        <div class="planet-card">
          <div class="planet-name">Saturno</div>
          <div class="planet-details">
            <p>Dist√¢ncia: 9.5 AU</p>
            <p>Per√≠odo: 29 anos</p>
            <p>Temperatura: -140¬∞C</p>
          </div>
        </div>
        <div class="planet-card">
          <div class="planet-name">Urano</div>
          <div class="planet-details">
            <p>Dist√¢ncia: 19.8 AU</p>
            <p>Per√≠odo: 84 anos</p>
            <p>Temperatura: -195¬∞C</p>
          </div>
        </div>
        <div class="planet-card">
          <div class="planet-name">Netuno</div>
          <div class="planet-details">
            <p>Dist√¢ncia: 30.1 AU</p>
            <p>Per√≠odo: 165 anos</p>
            <p>Temperatura: -200¬∞C</p>
          </div>
        </div>
      </div>
      
      <div class="galaxy-scene">
        <a-scene embedded background="color: #000000" renderer="antialias: true; precision: high">
          <a-assets>
            <!-- Texturas dos planetas -->
            <img id="sun" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/sun.jpg">
            <img id="mercury" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/mercury.jpg">
            <img id="venus" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/venus.jpg">
            <img id="earth" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth.jpg">
            <img id="mars" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/mars.jpg">
            <img id="jupiter" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/jupiter.jpg">
            <img id="saturn" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/saturn.jpg">
            <img id="uranus" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/uranus.jpg">
            <img id="neptune" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/neptune.jpg">
          </a-assets>

          <!-- Fundo estelar -->
          <a-sky color="#000000">
            <a-entity geometry="primitive: plane" material="color: white; transparent: true; opacity: 0.8" scale="1000 1000 1">
              <a-animation attribute="rotation" dur="100000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>
          </a-sky>

          <!-- Sistema Solar -->
          <a-entity id="solar-system" position="0 0 -50">
            <!-- Sol -->
            <a-sphere radius="3" position="0 0 0" 
                     material="src: #sun; emissive: #ffff00; emissiveIntensity: 1; roughness: 0.1; metalness: 0.9; shader: standard">
              <a-animation attribute="rotation" dur="86400" to="0 360 0" repeat="indefinite"></a-animation>
            </a-sphere>

            <!-- Merc√∫rio -->
            <a-entity position="5 0 0">
              <a-sphere radius="0.2" material="src: #mercury; roughness: 0.7; metalness: 0.3; shader: standard; normalMap: #mercury; normalScale: 0.5 0.5"></a-sphere>
              <a-ring radius="5" segments="64" material="color: #666; opacity: 0.2; side: double"></a-ring>
              <a-animation attribute="rotation" dur="88000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>

            <!-- V√™nus -->
            <a-entity position="8 0 0">
              <a-sphere radius="0.4" material="src: #venus; roughness: 0.8; metalness: 0.2; shader: standard; normalMap: #venus; normalScale: 0.5 0.5"></a-sphere>
              <a-ring radius="8" segments="64" material="color: #666; opacity: 0.2; side: double"></a-ring>
              <a-animation attribute="rotation" dur="225000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>

            <!-- Terra -->
            <a-entity position="12 0 0">
              <a-sphere radius="0.5" material="src: #earth; roughness: 0.7; metalness: 0.3; shader: standard; normalMap: #earth; normalScale: 0.5 0.5"></a-sphere>
              <a-ring radius="12" segments="64" material="color: #666; opacity: 0.2; side: double"></a-ring>
              <a-animation attribute="rotation" dur="365000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>

            <!-- Marte -->
            <a-entity position="16 0 0">
              <a-sphere radius="0.3" material="src: #mars; roughness: 0.8; metalness: 0.2; shader: standard; normalMap: #mars; normalScale: 0.5 0.5"></a-sphere>
              <a-ring radius="16" segments="64" material="color: #666; opacity: 0.2; side: double"></a-ring>
              <a-animation attribute="rotation" dur="687000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>

            <!-- J√∫piter -->
            <a-entity position="22 0 0">
              <a-sphere radius="1.2" material="src: #jupiter; roughness: 0.6; metalness: 0.4; shader: standard; normalMap: #jupiter; normalScale: 0.5 0.5"></a-sphere>
              <a-ring radius="22" segments="64" material="color: #666; opacity: 0.2; side: double"></a-ring>
              <a-animation attribute="rotation" dur="4380000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>

            <!-- Saturno -->
            <a-entity position="28 0 0">
              <a-sphere radius="1" material="src: #saturn; roughness: 0.7; metalness: 0.3; shader: standard; normalMap: #saturn; normalScale: 0.5 0.5"></a-sphere>
              <a-ring radius="1.1" radius-inner="1.2" rotation="90 0 0" material="color: #666; opacity: 0.8"></a-ring>
              <a-ring radius="28" segments="64" material="color: #666; opacity: 0.2; side: double"></a-ring>
              <a-animation attribute="rotation" dur="10585000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>

            <!-- Urano -->
            <a-entity position="34 0 0">
              <a-sphere radius="0.7" material="src: #uranus; roughness: 0.8; metalness: 0.2; shader: standard; normalMap: #uranus; normalScale: 0.5 0.5"></a-sphere>
              <a-ring radius="34" segments="64" material="color: #666; opacity: 0.2; side: double"></a-ring>
              <a-animation attribute="rotation" dur="30660000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>

            <!-- Netuno -->
            <a-entity position="40 0 0">
              <a-sphere radius="0.6" material="src: #neptune; roughness: 0.8; metalness: 0.2; shader: standard; normalMap: #neptune; normalScale: 0.5 0.5"></a-sphere>
              <a-ring radius="40" segments="64" material="color: #666; opacity: 0.2; side: double"></a-ring>
              <a-animation attribute="rotation" dur="60190000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-entity>
          </a-entity>

          <!-- C√¢mera -->
          <a-entity id="camera" camera look-controls wasd-controls position="0 0 0">
            <a-entity cursor="fuse: true; fuseTimeout: 500"
                      position="0 0 -1"
                      geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: white; shader: flat">
            </a-entity>
          </a-entity>
        </a-scene>
      </div>
    </div>

    <a-scene id="sky-map" embedded>
      <a-sky id="sky" color="#0d1b2a"></a-sky>
      <a-entity id="stars-container"></a-entity>
    </a-scene>
  </div>

  <script>
    let latitude, longitude;
    let scene, starsContainer;
    let isLocationLoading = false;
    let isDataLoading = false;

    // Inicializa√ß√£o do A-Frame
    document.addEventListener('DOMContentLoaded', function() {
      scene = document.querySelector('a-scene');
      starsContainer = document.getElementById('stars-container');
      
      // Aguardar a cena estar carregada
      scene.addEventListener('loaded', function() {
        criarEstrelas();
      });

      // Adicionar listeners para valida√ß√£o em tempo real
      document.getElementById('lat').addEventListener('input', validateCoordinates);
      document.getElementById('lon').addEventListener('input', validateCoordinates);
    });

    function showMessage(elementId, message, isError = true) {
      const element = document.getElementById(elementId);
      element.textContent = message;
      element.classList.add('show');
      
      setTimeout(() => {
        element.classList.remove('show');
      }, 5000);
    }

    function showLoading(show) {
      const loadingElement = document.getElementById('loading');
      loadingElement.style.display = show ? 'block' : 'none';
    }

    function validateCoordinates() {
      const lat = document.getElementById('lat').value;
      const lon = document.getElementById('lon').value;
      const loadBtn = document.getElementById('load-btn');

      if (lat && lon) {
        const latNum = parseFloat(lat);
        const lonNum = parseFloat(lon);
        
        if (isNaN(latNum) || isNaN(lonNum)) {
          loadBtn.disabled = true;
          return false;
        }
        
        if (latNum < -90 || latNum > 90 || lonNum < -180 || lonNum > 180) {
          loadBtn.disabled = true;
          return false;
        }
        
        loadBtn.disabled = false;
        return true;
      }
      
      loadBtn.disabled = true;
      return false;
    }

    function criarEstrelas() {
      if (!starsContainer) return;
      
      starsContainer.innerHTML = '';
      
      const layers = 3;
      const starsPerLayer = 300;
      
      for (let layer = 0; layer < layers; layer++) {
        const distance = 50 + (layer * 25);
        for (let i = 0; i < starsPerLayer; i++) {
          const star = document.createElement('a-entity');
          const size = Math.random() * 0.03 + 0.01;
          
          star.setAttribute('geometry', {
            primitive: 'sphere',
            radius: size
          });
          
          star.setAttribute('material', {
            color: '#ffffff',
            shader: 'flat',
            opacity: 0.8 - (layer * 0.2)
          });
          
          const theta = Math.random() * Math.PI * 2;
          const phi = Math.random() * Math.PI;
          
          star.setAttribute('position', {
            x: distance * Math.sin(phi) * Math.cos(theta),
            y: distance * Math.sin(phi) * Math.sin(theta),
            z: distance * Math.cos(phi)
          });
          
          starsContainer.appendChild(star);
        }
      }
    }

    function atualizarCenario(corDoCeu) {
      const sky = document.getElementById('sky');
      if (sky) {
        sky.setAttribute('color', corDoCeu);
        criarEstrelas();
      }
    }

    function getMoonPhaseName(phase) {
      // Ajustando os valores para corresponder √† API
      const normalizedPhase = phase % 1; // Garantir que o valor esteja entre 0 e 1
      
      if (normalizedPhase === 0 || normalizedPhase === 1) return "üåë Lua Nova";
      if (normalizedPhase < 0.25) return "üåí Lua Crescente";
      if (normalizedPhase === 0.25) return "üåì Quarto Crescente";
      if (normalizedPhase < 0.5) return "üåî Crescente Gibosa";
      if (normalizedPhase === 0.5) return "üåï Lua Cheia";
      if (normalizedPhase < 0.75) return "üåñ Minguante Gibosa";
      if (normalizedPhase === 0.75) return "üåó Quarto Minguante";
      return "üåò Lua Minguante";
    }

    function obterFasesDaLua(lat, lon) {
      return new Promise((resolve, reject) => {
        if (lat < -90 || lat > 90 || lon < -180 || lon > 180) {
          reject(new Error("Coordenadas inv√°lidas"));
          return;
        }

        const url = new URL('/api/forecast', window.location.origin);
        url.searchParams.append('latitude', lat);
        url.searchParams.append('longitude', lon);

        console.log('URL da API:', url.toString());

        fetch(url.toString())
          .then(res => {
            if (!res.ok) {
              return res.text().then(text => {
                console.error('Resposta da API:', text);
                throw new Error(`Erro na API: ${res.status} ${res.statusText} - ${text}`);
              });
            }
            return res.json();
          })
          .then(data => {
            console.log('Dados recebidos:', data);
            // Simular fases da lua baseadas na data atual
            const fasesSimuladas = Array(7).fill(0).map((_, i) => {
              const fase = (i / 7) % 1;
              return fase;
            });
            resolve(fasesSimuladas);
          })
          .catch(err => {
            console.error('Erro detalhado:', err);
            // Em caso de erro, usar dados simulados
            const fasesSimuladas = Array(7).fill(0).map((_, i) => {
              const fase = (i / 7) % 1;
              return fase;
            });
            resolve(fasesSimuladas);
          });
      });
    }

    function obterDadosClima(lat, lon) {
      return new Promise((resolve, reject) => {
        // Simular dados do clima temporariamente
        const dadosSimulados = {
          temperatura: Math.round(20 + Math.random() * 10),
          vento: Math.round(5 + Math.random() * 15),
          umidade: Math.round(40 + Math.random() * 40),
          precipitacao: Math.round(Math.random() * 30)
        };
        resolve(dadosSimulados);
      });
    }

    function obterDadosSatelites(lat, lon) {
      return new Promise((resolve, reject) => {
        // Simular dados dos sat√©lites temporariamente
        const agora = new Date();
        const proximaPassagem = new Date(agora.getTime() + 30 * 60 * 1000); // 30 minutos no futuro
        
        resolve({
          iss: {
            visivel: Math.random() > 0.5,
            proximaPassagem: proximaPassagem.toLocaleTimeString()
          },
          hubble: {
            visivel: false,
            proximaPassagem: '--:--'
          }
        });
      });
    }

    function usarLocalizacao() {
      if (isLocationLoading) return;
      
      const botao = document.getElementById('location-btn');
      botao.disabled = true;
      isLocationLoading = true;
      botao.innerText = "Carregando...";

      if (!navigator.geolocation) {
        showMessage('error-message', "Seu navegador n√£o suporta geolocaliza√ß√£o.");
        botao.disabled = false;
        isLocationLoading = false;
        botao.innerText = "üìç Usar Localiza√ß√£o Atual";
        return;
      }

      navigator.geolocation.getCurrentPosition(
        pos => {
          document.getElementById("lat").value = pos.coords.latitude.toFixed(4);
          document.getElementById("lon").value = pos.coords.longitude.toFixed(4);
          showMessage('success-message', "Localiza√ß√£o obtida com sucesso!", false);
          validateCoordinates();
          botao.disabled = false;
          isLocationLoading = false;
          botao.innerText = "üìç Usar Localiza√ß√£o Atual";
        },
        err => {
          let errorMessage = "Erro ao obter localiza√ß√£o.";
          switch(err.code) {
            case err.PERMISSION_DENIED:
              errorMessage = "Acesso √† localiza√ß√£o negado. Por favor, permita o acesso nas configura√ß√µes do seu navegador.";
              break;
            case err.POSITION_UNAVAILABLE:
              errorMessage = "Localiza√ß√£o indispon√≠vel. Verifique sua conex√£o com a internet.";
              break;
            case err.TIMEOUT:
              errorMessage = "Tempo limite excedido ao obter localiza√ß√£o.";
              break;
          }
          showMessage('error-message', errorMessage);
          botao.disabled = false;
          isLocationLoading = false;
          botao.innerText = "üìç Usar Localiza√ß√£o Atual";
        },
        { 
          timeout: 10000,
          maximumAge: 0,
          enableHighAccuracy: true 
        }
      );
    }

    function showTab(tabName) {
      // Esconder todos os conte√∫dos
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Desativar todos os bot√µes
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
      });
      
      // Mostrar o conte√∫do selecionado
      document.getElementById(tabName + '-info').classList.add('active');
      
      // Ativar o bot√£o selecionado
      event.target.classList.add('active');
    }

    function carregarAstros() {
      if (isDataLoading) return;
      
      latitude = parseFloat(document.getElementById("lat").value);
      longitude = parseFloat(document.getElementById("lon").value);

      if (!validateCoordinates()) {
        showMessage('error-message', "‚ö†Ô∏è Por favor, informe coordenadas v√°lidas.");
        return;
      }

      isDataLoading = true;
      showLoading(true);
      
      const skyColor = (latitude > 0) ? "#001f3d" : "#0d1b2a";
      atualizarCenario(skyColor);

      // Carregar dados da lua
      obterFasesDaLua(latitude, longitude)
        .then(fases => {
          const fasesFormatadas = fases.map((fase, index) => {
            const data = new Date();
            data.setDate(data.getDate() + index);
            return {
              date: data,
              phase: fase,
              name: getMoonPhaseName(fase)
            };
          });
          
          const moonPhaseHTML = fasesFormatadas.map(fase => `
            <div class="moon-phase-item">
              <div class="moon-phase-name">${fase.name}</div>
              <div class="moon-phase-value">${(fase.phase * 100).toFixed(1)}%</div>
              <div class="moon-phase-date">${fase.date.toLocaleDateString()}</div>
            </div>
          `).join('');
          
          document.getElementById("astro-info").innerHTML = `
            <h2 class="section-title">üåô Fases da Lua</h2>
            <div class="moon-phase">
              ${moonPhaseHTML}
            </div>
            <div class="location-info">
              üìç Localiza√ß√£o: ${latitude.toFixed(4)}¬∞N, ${longitude.toFixed(4)}¬∞E
            </div>
          `;
        })
        .catch(err => {
          console.error('Erro ao carregar fases da lua:', err);
          document.getElementById("astro-info").innerHTML = `
            <p>N√£o foi poss√≠vel carregar os dados da Lua: ${err.message}</p>
            <div class="location-info">
              üìç Localiza√ß√£o: ${latitude.toFixed(4)}¬∞N, ${longitude.toFixed(4)}¬∞E
            </div>
          `;
        });

      // Carregar dados do clima
      obterDadosClima(latitude, longitude)
        .then(clima => {
          document.getElementById("temperature").textContent = `${clima.temperatura}¬∞C`;
          document.getElementById("wind").textContent = `${clima.vento} km/h`;
          document.getElementById("humidity").textContent = `${clima.umidade}%`;
          document.getElementById("precipitation").textContent = `${clima.precipitacao}%`;
        })
        .catch(err => {
          console.error('Erro ao carregar dados do clima:', err);
          showMessage('error-message', `Erro ao carregar dados do clima: ${err.message}`);
        });

      // Carregar dados dos sat√©lites
      obterDadosSatelites(latitude, longitude)
        .then(satelites => {
          document.getElementById("iss-status").textContent = satelites.iss.visivel ? "Vis√≠vel agora" : "N√£o vis√≠vel";
          document.getElementById("iss-next").textContent = `Pr√≥xima passagem: ${satelites.iss.proximaPassagem}`;
          document.getElementById("hubble-status").textContent = satelites.hubble.visivel ? "Vis√≠vel agora" : "N√£o vis√≠vel";
          document.getElementById("hubble-next").textContent = `Pr√≥xima passagem: ${satelites.hubble.proximaPassagem}`;
        })
        .catch(err => {
          console.error('Erro ao carregar dados dos sat√©lites:', err);
          showMessage('error-message', `Erro ao carregar dados dos sat√©lites: ${err.message}`);
        });

      // Calcular dados da gal√°xia
      const dadosGalaxia = calcularDadosGalaxia(latitude, longitude);
      document.getElementById("galaxy-distance").textContent = `${dadosGalaxia.distancia.toLocaleString()} anos-luz`;
      document.getElementById("galaxy-speed").textContent = `${dadosGalaxia.velocidade.toLocaleString()} km/s`;
      document.getElementById("galaxy-period").textContent = `${dadosGalaxia.periodo.toLocaleString()} milh√µes de anos`;
      
      showMessage('success-message', "Dados astron√¥micos carregados com sucesso!", false);
      showLoading(false);
      isDataLoading = false;
    }

    // Fun√ß√£o para calcular dados da gal√°xia
    function calcularDadosGalaxia(lat, lon) {
      // Valores aproximados para a posi√ß√£o do Sol na Via L√°ctea
      const distanciaCentro = 26000; // anos-luz
      const velocidadeOrbital = 230; // km/s
      const periodoOrbital = 225; // milh√µes de anos

      // Ajustes baseados na posi√ß√£o atual (simplificado)
      const ajusteLat = Math.abs(lat) / 90;
      const ajusteLon = Math.abs(lon) / 180;

      return {
        distancia: Math.round(distanciaCentro * (1 + ajusteLat * 0.1)),
        velocidade: Math.round(velocidadeOrbital * (1 + ajusteLon * 0.05)),
        periodo: Math.round(periodoOrbital * (1 + ajusteLat * 0.02))
      };
    }
  </script>
</body>
</html>
